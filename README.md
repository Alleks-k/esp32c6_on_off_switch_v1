# Zigbee On/Off Light on ESP32-C6

Ð¦ÐµÐ¹ Ð¿Ñ€Ð¾ÐµÐºÑ‚ Ñ€ÐµÐ°Ð»Ñ–Ð·ÑƒÑ” Zigbee-Ð¿Ñ€Ð¸ÑÑ‚Ñ€Ñ–Ð¹ Ñ‚Ð¸Ð¿Ñƒ **End Device (On/Off Light)** Ð½Ð° Ð±Ð°Ð·Ñ– Ð¼Ñ–ÐºÑ€Ð¾ÐºÐ¾Ð½Ñ‚Ñ€Ð¾Ð»ÐµÑ€Ð° **ESP32-C6**. ÐŸÑ€Ð¸ÑÑ‚Ñ€Ñ–Ð¹ Ð¼Ð¾Ð¶Ðµ ÐºÐµÑ€ÑƒÐ²Ð°Ñ‚Ð¸ÑÑ ÑÐº Ð²Ñ–Ð´Ð´Ð°Ð»ÐµÐ½Ð¾ Ñ‡ÐµÑ€ÐµÐ· Zigbee-ÑˆÐ»ÑŽÐ·, Ñ‚Ð°Ðº Ñ– Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ð¾ Ð·Ð° Ð´Ð¾Ð¿Ð¾Ð¼Ð¾Ð³Ð¾ÑŽ Ñ„Ñ–Ð·Ð¸Ñ‡Ð½Ð¾Ñ— ÐºÐ½Ð¾Ð¿ÐºÐ¸. Ð¡Ñ‚Ð°Ð½ Ð²Ñ–Ð´Ð¾Ð±Ñ€Ð°Ð¶Ð°Ñ”Ñ‚ÑŒÑÑ Ð·Ð° Ð´Ð¾Ð¿Ð¾Ð¼Ð¾Ð³Ð¾ÑŽ Ð²Ð±ÑƒÐ´Ð¾Ð²Ð°Ð½Ð¾Ð³Ð¾ Ð°Ð´Ñ€ÐµÑÐ½Ð¾Ð³Ð¾ RGB-ÑÐ²Ñ–Ñ‚Ð»Ð¾Ð´Ñ–Ð¾Ð´Ð° (WS2812).

## ðŸš€ Ð¤ÑƒÐ½ÐºÑ†Ñ–Ð¾Ð½Ð°Ð»

- **Zigbee 3.0 Stack**: Ð ÐµÐ°Ð»Ñ–Ð·Ð°Ñ†Ñ–Ñ ÑÑ‚Ð°Ð½Ð´Ð°Ñ€Ñ‚Ð½Ð¾Ð³Ð¾ ÐºÐ»Ð°ÑÑ‚ÐµÑ€Ð° `On/Off` (Cluster ID: 0x0006).
- **Ð¢Ð¸Ð¿ Ð¿Ñ€Ð¸ÑÑ‚Ñ€Ð¾ÑŽ**: `HA On/Off Light` (Ñ‰Ð¾ Ð´Ð¾Ð·Ð²Ð¾Ð»ÑÑ” ÑˆÐ»ÑŽÐ·Ð°Ð¼ Ð±Ð°Ñ‡Ð¸Ñ‚Ð¸ Ð¹Ð¾Ð³Ð¾ ÑÐº Ð²Ð¸ÐºÐ¾Ð½Ð°Ð²Ñ‡Ð¸Ð¹ Ð¿Ñ€Ð¸ÑÑ‚Ñ€Ñ–Ð¹, Ð° Ð½Ðµ Ð¿Ñ€Ð¾ÑÑ‚Ð¾ Ð²Ð¸Ð¼Ð¸ÐºÐ°Ñ‡).
- **ÐÐ´Ñ€ÐµÑÐ½Ð¸Ð¹ LED**: ÐšÐµÑ€ÑƒÐ²Ð°Ð½Ð½Ñ Ð²Ð±ÑƒÐ´Ð¾Ð²Ð°Ð½Ð¸Ð¼ RGB-ÑÐ²Ñ–Ñ‚Ð»Ð¾Ð´Ñ–Ð¾Ð´Ð¾Ð¼ Ñ‡ÐµÑ€ÐµÐ· Ð±Ñ–Ð±Ð»Ñ–Ð¾Ñ‚ÐµÐºÑƒ `led_strip` (GPIO 8).
- **Ð›Ð¾ÐºÐ°Ð»ÑŒÐ½Ðµ ÐºÐµÑ€ÑƒÐ²Ð°Ð½Ð½Ñ**: Ð¤Ñ–Ð·Ð¸Ñ‡Ð½Ð° ÐºÐ½Ð¾Ð¿ÐºÐ° Ð´Ð¾Ð·Ð²Ð¾Ð»ÑÑ” Ð¿ÐµÑ€ÐµÐ¼Ð¸ÐºÐ°Ñ‚Ð¸ ÑÑ‚Ð°Ð½ Ð¿Ñ€Ð¸ÑÑ‚Ñ€Ð¾ÑŽ Ð±ÐµÐ· ÑƒÑ‡Ð°ÑÑ‚Ñ– ÑˆÐ»ÑŽÐ·Ñƒ.
- **Reporting**: ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡Ð½Ðµ Ð½Ð°Ð´ÑÐ¸Ð»Ð°Ð½Ð½Ñ Ð·Ð²Ñ–Ñ‚Ñ–Ð² Ð¿Ñ€Ð¾ ÑÑ‚Ð°Ð½ (Report) Ð½Ð° ÑˆÐ»ÑŽÐ· Ð¿Ñ€Ð¸ Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ð¾Ð¼Ñƒ Ð¿ÐµÑ€ÐµÐ¼Ð¸ÐºÐ°Ð½Ð½Ñ–.
- **ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡Ð½Ðµ Ð¿ÐµÑ€ÐµÐ¿Ñ–Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð½Ñ**: ÐœÐµÑ…Ð°Ð½Ñ–Ð·Ð¼ `Network Steering` Ð´Ð»Ñ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡Ð½Ð¾Ð³Ð¾ Ð¿Ð¾ÑˆÑƒÐºÑƒ Ñ‚Ð° Ð¿Ñ€Ð¸Ñ”Ð´Ð½Ð°Ð½Ð½Ñ Ð´Ð¾ Ð¼ÐµÑ€ÐµÐ¶Ñ– Zigbee.

## ðŸ›  ÐÐ¿Ð°Ñ€Ð°Ñ‚Ð½Ñ– Ð²Ð¸Ð¼Ð¾Ð³Ð¸

- **ÐŸÐ»Ð°Ñ‚Ð°**: ESP32-C6 DevKitC-1 (Ð°Ð±Ð¾ Ð±ÑƒÐ´ÑŒ-ÑÐºÐ° Ñ–Ð½ÑˆÐ° Ð¿Ð»Ð°Ñ‚Ð° Ð½Ð° Ð±Ð°Ð·Ñ– ESP32-C6).
- **RGB LED**: Ð’Ð±ÑƒÐ´Ð¾Ð²Ð°Ð½Ð¸Ð¹ WS2812 Ð¿Ñ–Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ð¹ Ð´Ð¾ **GPIO 8**.
- **ÐšÐ½Ð¾Ð¿ÐºÐ°**: Ð’Ð±ÑƒÐ´Ð¾Ð²Ð°Ð½Ð° ÐºÐ½Ð¾Ð¿ÐºÐ° BOOT Ð¿Ñ–Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð° Ð´Ð¾ **GPIO 9** (Ð²Ð¸ÐºÐ¾Ñ€Ð¸ÑÑ‚Ð¾Ð²ÑƒÑ”Ñ‚ÑŒÑÑ Ð´Ð»Ñ Toggle Ñ‚Ð° ÑÐºÐ¸Ð´Ð°Ð½Ð½Ñ).

## ðŸ’» ÐŸÑ€Ð¾Ð³Ñ€Ð°Ð¼Ð½Ñ– Ð²Ð¸Ð¼Ð¾Ð³Ð¸

- **ESP-IDF**: Ð²ÐµÑ€ÑÑ–Ñ v5.1 Ð°Ð±Ð¾ Ð½Ð¾Ð²Ñ–ÑˆÐ°.
- **ESP Zigbee SDK**: ÑÑƒÐ¼Ñ–ÑÐ½Ñ–ÑÑ‚ÑŒ Ð· Ð²ÐµÑ€ÑÑ–Ñ”ÑŽ v1.6.8.
- **Ð—Ð°Ð»ÐµÐ¶Ð½Ð¾ÑÑ‚Ñ–**: ÐºÐ¾Ð¼Ð¿Ð¾Ð½ÐµÐ½Ñ‚ `espressif/led_strip`.

## ðŸ”§ ÐÐ°Ð»Ð°ÑˆÑ‚ÑƒÐ²Ð°Ð½Ð½Ñ Ñ‚Ð° Ð·Ð±Ñ–Ñ€ÐºÐ°

1. **Ð’ÑÑ‚Ð°Ð½Ð¾Ð²Ñ–Ñ‚ÑŒ Ñ†Ñ–Ð»ÑŒÐ¾Ð²Ñƒ Ð¿Ð»Ð°Ñ‚Ñ„Ð¾Ñ€Ð¼Ñƒ**:
   ```bash
   idf.py set-target esp32c6
   ```

2. **Ð”Ð¾Ð´Ð°Ð¹Ñ‚Ðµ Ð½ÐµÐ¾Ð±Ñ…Ñ–Ð´Ð½Ñ– ÐºÐ¾Ð¼Ð¿Ð¾Ð½ÐµÐ½Ñ‚Ð¸**:
   ```bash
   idf.py add-dependency "espressif/led_strip"
   ```

3. **Ð¡ÐºÐ¾Ð¼Ð¿Ñ–Ð»ÑŽÐ¹Ñ‚Ðµ Ð¿Ñ€Ð¾ÐµÐºÑ‚**:
   ```bash
   idf.py build
   ```

4. **ÐŸÑ€Ð¾ÑˆÐ¸Ð¹Ñ‚Ðµ Ð¿Ñ€Ð¸ÑÑ‚Ñ€Ñ–Ð¹**:
   ```bash
   idf.py -p [PORT] flash monitor
   ```

## ðŸ”— Ð—'Ñ”Ð´Ð½Ð°Ð½Ð½Ñ Ð· Ð¼ÐµÑ€ÐµÐ¶ÐµÑŽ (Pairing)

1. ÐŸÐµÑ€ÐµÐ²ÐµÐ´Ñ–Ñ‚ÑŒ Ð²Ð°Ñˆ Zigbee-ÑˆÐ»ÑŽÐ· Ñƒ Ñ€ÐµÐ¶Ð¸Ð¼ Ð¿Ð¾ÑˆÑƒÐºÑƒ Ð½Ð¾Ð²Ð¸Ñ… Ð¿Ñ€Ð¸ÑÑ‚Ñ€Ð¾Ñ—Ð² (Permit Join).
2. Ð¯ÐºÑ‰Ð¾ Ð¿Ñ€Ð¸ÑÑ‚Ñ€Ñ–Ð¹ Ð½Ð¾Ð²Ð¸Ð¹, Ð²Ñ–Ð½ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡Ð½Ð¾ Ð¿Ð¾Ñ‡Ð½Ðµ Ð¿Ð¾ÑˆÑƒÐº Ð¼ÐµÑ€ÐµÐ¶Ñ– Ð¿Ñ€Ð¸ ÑÑ‚Ð°Ñ€Ñ‚Ñ–.
3. Ð¯ÐºÑ‰Ð¾ Ð¿Ñ€Ð¸ÑÑ‚Ñ€Ñ–Ð¹ Ð²Ð¶Ðµ Ð±ÑƒÐ² Ð¿Ñ–Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ð¹ Ð´Ð¾ Ñ–Ð½ÑˆÐ¾Ñ— Ð¼ÐµÑ€ÐµÐ¶Ñ–, Ð²Ð¸ÐºÐ¾Ð½Ð°Ð¹Ñ‚Ðµ Ð¿Ð¾Ð²Ð½Ðµ Ð¾Ñ‡Ð¸Ñ‰ÐµÐ½Ð½Ñ Ð¿Ð°Ð¼'ÑÑ‚Ñ– Ð¿ÐµÑ€ÐµÐ´ Ð¿Ñ€Ð¾ÑˆÐ¸Ð²ÐºÐ¾ÑŽ:
   ```bash
   idf.py erase-flash
   ```
4. ÐŸÑ–ÑÐ»Ñ ÑƒÑÐ¿Ñ–ÑˆÐ½Ð¾Ð³Ð¾ Ð¿Ñ–Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð½Ñ Ð² ÐºÐ¾Ð½ÑÐ¾Ð»Ñ– Ð·'ÑÐ²Ð¸Ñ‚ÑŒÑÑ Ð¿Ð¾Ð²Ñ–Ð´Ð¾Ð¼Ð»ÐµÐ½Ð½Ñ:
   `Joined network successfully! PAN: 0xXXXX, Addr: 0xXXXX`

## ðŸ“‚ Ð¡Ñ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð° Ð¿Ñ€Ð¾ÐµÐºÑ‚Ñƒ

- `main/esp_zb_switch.c`: ÐžÑÐ½Ð¾Ð²Ð½Ð° Ð»Ð¾Ð³Ñ–ÐºÐ° Zigbee ÑÑ‚ÐµÐºÐ°, Ñ–Ð½Ñ–Ñ†Ñ–Ð°Ð»Ñ–Ð·Ð°Ñ†Ñ–Ñ `led_strip` Ñ‚Ð° Ð¾Ð±Ñ€Ð¾Ð±ÐºÐ° ÐºÐ¾Ð¼Ð°Ð½Ð´.
- `main/esp_zb_switch.h`: ÐšÐ¾Ð½Ñ„Ñ–Ð³ÑƒÑ€Ð°Ñ†Ñ–Ñ ÐµÐ½Ð´Ð¿Ð¾Ñ–Ð½Ñ‚Ñ–Ð², Ð½Ð¾Ð¼ÐµÑ€Ñ–Ð² GPIO Ñ‚Ð° Ñ–Ð´ÐµÐ½Ñ‚Ð¸Ñ„Ñ–ÐºÐ°Ñ‚Ð¾Ñ€Ñ–Ð² Ð²Ð¸Ñ€Ð¾Ð±Ð½Ð¸ÐºÐ°.
- `main/www/`: (ÐžÐ¿Ñ†Ñ–Ð¾Ð½Ð°Ð»ÑŒÐ½Ð¾) Ð’ÐµÐ±-Ñ€ÐµÑÑƒÑ€ÑÐ¸, ÑÐºÑ‰Ð¾ Ð¿Ñ€Ð¾ÐµÐºÑ‚ Ð²Ð¸ÐºÐ¾Ñ€Ð¸ÑÑ‚Ð¾Ð²ÑƒÑ”Ñ‚ÑŒÑÑ ÑÐº Ñ‡Ð°ÑÑ‚Ð¸Ð½Ð° ÑˆÐ»ÑŽÐ·Ñƒ.

## ðŸ“ ÐÐ¾Ñ‚Ð°Ñ‚ÐºÐ¸ Ñ‰Ð¾Ð´Ð¾ Ñ€Ð¾Ð·Ñ€Ð¾Ð±ÐºÐ¸

ÐŸÑ€Ð¾ÐµÐºÑ‚ Ð¾Ð¿Ñ‚Ð¸Ð¼Ñ–Ð·Ð¾Ð²Ð°Ð½Ð¾ Ð´Ð»Ñ Ñ€Ð¾Ð±Ð¾Ñ‚Ð¸ Ð· ESP Zigbee SDK Ð²ÐµÑ€ÑÑ–Ñ— **v1.6.8**. Ð£ Ñ†Ñ–Ð¹ Ð²ÐµÑ€ÑÑ–Ñ— Ð´Ð¾ÑÑ‚ÑƒÐ¿ Ð´Ð¾ Ð´Ð°Ð½Ð¸Ñ… Ð°Ñ‚Ñ€Ð¸Ð±ÑƒÑ‚Ñ–Ð² Ð·Ð´Ñ–Ð¹ÑÐ½ÑŽÑ”Ñ‚ÑŒÑÑ Ñ‡ÐµÑ€ÐµÐ· Ð²ÐºÐ»Ð°Ð´ÐµÐ½Ñ– ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð¸:
- ÐžÑ‚Ñ€Ð¸Ð¼Ð°Ð½Ð½Ñ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð½Ñ: `*(bool *)set_attr_msg->attribute.data.value`
- Ð›Ð¾ÐºÐ°Ð»ÑŒÐ½Ðµ Ñ‡Ð¸Ñ‚Ð°Ð½Ð½Ñ: `*(bool *)attr->data_p`

---
**Ð Ð¾Ð·Ñ€Ð¾Ð±Ð½Ð¸Ðº:** [Alleks-k](https://github.com/Alleks-k)